{% extends "base.html" %}
{% import 'forms.html' as forms %}

{% macro objective_list_group(objectives) %}
	<ul class="list-group">
		{% for objective in objectives %}
			<li class="list-group-item d-flex justify-content-between align-items-start">
				<div class = "container">

                    <div class="row pt-2">
                        <div class="col">
                            <div class="fw-bold fs-8">
                                {{ objective.description }}
                                {% set average = 0 %}
                                {% set count = 0 %}
                                {% for user in course.users %}
                                    {% set average = average + objective.get_e_factor_average(user, assessment) %}
                                {% endfor %}
                                {% if course.users.count() == 0 %}
                                    {% set count = 1 %}
                                {% else %}
                                    {% set count = course.users.count() %}
                                {% endif%}
                                {% set rating = average / count %}
                                {% if rating < 1.8 %}
                                    {% set full = 1 %}  
                                {% elif rating < 2.4 %}
                                    {% set full = 2 %} 
                                {% elif rating < 3 %}
                                    {% set full = 3 %}
                                {% elif rating < 5 %}
                                    {% set full = 4 %}
                                {% else %}
                                    {% set full = 5 %}
                                {% endif %}
                                {% for i in range(full) %}
                                    <i class="bi bi-star-fill" style="color: gold"></i>
                                    {% endfor %}
                                {% for i in range(5-full) %}
                                    <i class="bi bi-star" style="color: gold"></i>
                                    {% endfor %}
                            </div>
                        
                        </div>

                        <div class="col">
                            <div class="row">
                                <div class="progress" style="height: 20px; float:right; width:30%;">
                                    <div class="progress-bar bg-success w3-container w3-center" role="progressbar" 
                                         style="width:50%" 
                                         aria-valuenow=50 aria-valuemin="0" 
                                         aria-valuemax=100>
                                    </div>
                                </div>
                            </div>
                            <div class="row pt-2">
                                <div class="progress" style="height: 20px; float:right; width:30%;">
                                    <div class="progress-bar bg-success w3-container w3-center" role="progressbar" 
                                    style="width:50%" 
                                    aria-valuenow=50 aria-valuemin="0" 
                                    aria-valuemax=100>
                                    </div>
                                </div>
                            </div>
                            <div class="row pt-2">
                                <div class="progress" style="height: 20px; float:right; width:30%;">
                                    <div class="progress-bar bg-success w3-container w3-center" role="progressbar" 
                                    style="width:50%" 
                                    aria-valuenow=50 aria-valuemin="0" 
                                    aria-valuemax=100>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col w-auto">
                            <div class="row">
                                <a role="button" class=" btn btn-sm btn-primary position-relative" style = "width:30%"
                                href="{{ url_for('instructor.most_missed_questions', course_name=course.name, mission_id=assessment.id, objective_id=objective.id) }}">
                                Most Missed Questions
                                </a>
                            </div>
                            <div class="row pt-2">
                                <a role="button" class="mt-auto btn btn-sm btn-primary position-relative" style = "width:50%"
                                href="{{ url_for('user_views.test', course_name=course.name, mission_id=assessment.id) }}">
                                See Overall Objective Statistics: not linked yet
                                </a>
                            </div>
                        </div>
                        
                    </div>
            
                </div>
			</li>
		{% endfor %}
	</ul>
{% endmacro %}

{% block body %}
    <div class="container pt-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('user_views.root') }}">Home</a></li>
				<li class="breadcrumb-item"><a href="{{ url_for('user_views.course_overview',course_name=course.name) }}">{{ course.name }}</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('instructor.assessment_statistics',course_name=course.name) }}">Assessment Statistics</a></li>
                <li class="breadcrumb-item active" aria-current="page"> {{assessment.title}} Objective Statistics</li>
            </ol>
        </nav>

		<h5>Learning Objective Progress: {{assessment.title}}</h5>
		{{ objective_list_group(assessment.objectives) }}

    </div>
{% endblock %}
