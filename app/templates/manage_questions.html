{% extends "base.html" %}
{% block body %}
    <div class="container pt-3">
        <h4>Manage Questions</h4>

		<div class="container row">
			<h5>Add Questions</h5>
			<ul class="list-unstyled mx-3">
                <li>
                    <a class="btn btn-link text-decoration-none" href="{{ url_for('instructor.find_questions', course_name=course.name) }}">Find Questions By Topic</a>
                </li>
                <li>
                    <a class="btn btn-link text-decoration-none" href="{{ url_for('instructor.add_question', course_name=course.name) }}">Browse All Existing Questions</a>
                </li>
                <li>
                    <span class="dropdown">
                        <button class="btn btn-link dropdown-toggle text-decoration-none" type="button" id="newQuestionButton" data-bs-toggle="dropdown" aria-expanded="false">
                            Create New Question
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="newQuestionButton">
                            <li><a class="dropdown-item" href="{{url_for('instructor.create_new_question', question_type='short-answer')}}">Short Answer (Self-Graded)</a></li>
                            <li><a class="dropdown-item" href="{{url_for('instructor.create_new_question', question_type='auto-check')}}">Short Answer (Auto-Graded)</a></li>
                            <li><a class="dropdown-item" href="{{url_for('instructor.create_new_question', question_type='multiple-choice')}}">Multiple Choice</a></li>
                            <li><a class="dropdown-item" href="{{url_for('instructor.create_new_question', question_type='code-jumble')}}">Code Jumble</a></li>
                        </ul>
                    </span>
                </li>
			</ul>
		</div>

		<div class="container row">
			<h5>Current Questions</h5>
			<ul class="list-unstyled">
				{% for q in questions %}
					{% set q_id = "question-" ~ q.id %}

					<li class="m-2 border-bottom" id="{{q_id}}">
						<div class="container row">
							<div class="col border bg-light p-1">
								{{ q.prompt|mdown|safe }}
							</div>
							<div class="col-md-2">
								<strong>Attempts:</strong>
								<br/><i class="bi-check-circle" style="color: green;"></i>
								Correct: {{ q.correct_attempts()|length }}
								<br/><i class="bi-x-circle" style="color: red;"></i>
								Incorrect: {{ q.incorrect_attempts()|length }}
							</div>
						</div>
						<div class="container row my-2">
							{% set remove_url = url_for('course_question', course_id=course.id, question_id=q.id, _external=True) %}
							<div class="col">
								<a role="button"
									class=" btn btn-sm btn-outline-primary"
									 href="{{ url_for('instructor.preview_question', question_id=q.id) }}">
									Preview
								</a>
								<button type="button" 
                                        onclick="removeQuestion('{{remove_url}}', '{{q_id}}', '{{ url_for('auth.refresh_jwts') }}')" 
										class=" btn btn-sm btn-outline-danger">
									Remove
								</button>
							</div>
						</div>
					</li>
				{% endfor %}
			</ul>
		</div>
    </div>

	<div id="snackbar">Default message.</div> 

	<script src="{{ url_for('static', filename='js/helpers.js') }}" type="module"></script>

	<script type="module">
		import { fetchOrRefresh, getCookie, showSnackbarMessage } from '/static/js/helpers.js';

		window.removeQuestion = async function removeQuestion(url, q_id, refresh_url) {
            const response = await fetchOrRefresh(url, 'DELETE', refresh_url);

			if (!response.ok) {
				showSnackbarMessage(`Error removing question. (HTTP Status: ${response.status})`);
				return
			}

			// remove the question from the list on this page
			const to_remove = document.getElementById(q_id);
			to_remove.parentNode.removeChild(to_remove);

			showSnackbarMessage("Question successfully removed.");
		}
	</script>
{% endblock %}
