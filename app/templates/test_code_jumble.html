{% extends "base.html" %}
{% import 'forms.html' as forms %}

{% block body %}
	<div class="container pt-3">
		{% if preview_mode %}
			<div class="text-danger row mb-3">
				<strong><i class="bi-eye-fill"></i> Question Preview</strong>
			</div>
		{% elif not fresh_question %}
			<div class="row text-end">
				<strong><i class="bi-arrow-repeat"></i> Repeat Question</strong>
			</div>
		{% endif %}

		<div class="row" id="prompt">
			{{ prompt }}
		</div>

        <div class="row" id="response_area">
            <div class="col-md-6">
                <strong>Your Answer:</strong>
                <ul id="jumbley" class="list-unstyled jumble">
                    {% for (block_id, block) in code_blocks %}
                        <li block-id="{{ block_id }}" indent-level="0">
                            <span class="row align-items-center">
                                <span class="col-auto">
                                    <i class="bi-arrow-right" style="font-size: 0.9em" onclick="change_indent({{block_id}}, 1);"></i>
                                    <br/>
                                    <i class="bi-arrow-left" style="font-size: 0.9em" onclick="change_indent({{block_id}}, -1)"></i>
                                </span>
                                <span class="col-auto jumble-block">
                                    {{ block }}
                                </span>
                            </span>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="col-md-6">
                 <i class="bi-trash"></i>

                 <strong>Unused Code:</strong>
                 <ul id="jumble-trash" class="list-unstyled jumble">
                     <li>Drag unnecessary / incorrect code blocks here.</li>
                 </ul>
            </div>
        </div>

		<div class="row">
			<form method="POST" 
		 		  action="{% if not preview_mode %}{{ url_for('user_views.test_code_jumble', course_name=course_name) }}{% endif %}">
				
				{{ form.csrf_token }}
				{{ form.question_id }}
				{{ form.response }}
				{{ form.no_answer(class_="btn btn-secondary btn-sm") }}
				{{ form.submit(class_="btn btn-primary btn-sm") }}
			</form>
		</div>
    </div>

    <script src="{{ url_for('static', filename='js/code-jumble.js') }}"></script>
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            initialize_jumble(document.getElementById("jumbley"), document.getElementById("jumble-trash"));
            update_response();
        });
    </script>

	{% if preview_mode %}
		<script type="text/javascript">
			window.addEventListener("DOMContentLoaded", () => {
				submit_button = document.getElementById("submit");
				submit_button.disabled = true;

				no_answer_button = document.getElementById("no_answer");
				no_answer_button.disabled = true;
			});
		</script>
	{% endif %}
{% endblock %}
